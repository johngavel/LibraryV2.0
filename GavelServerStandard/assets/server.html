
<!doctype html>
<!-- server.html -->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Server Status</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Use your existing stylesheet -->
  <link rel="stylesheet" href="/style/style.css" />
</head>
<body>

  <!-- Header populated by header.js -->
  <header id="site-header">
    <h1>Server</h1>
  </header>

   <main class="container">
    <!-- Program Info Card -->
    <section class="card" id="program-card" aria-labelledby="program-title">
      <h2 id="program-title">Program Info</h2>
      <div class="fieldset">
        <div class="row">
          <div class="field">
            <div class="label">Product</div>
            <div id="prog-product" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Version</div>
            <div id="prog-version" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Build Date</div>
            <div id="prog-date" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Build Time</div>
            <div id="prog-time" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Author</div>
            <div id="prog-author" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Device</div>
            <div id="prog-device" class="mono">—</div>
          </div>
        </div>
      </div>
    </section>

    <!-- IP Info Card -->
    <section class="card" id="ip-card" aria-labelledby="ip-title">
      <h2 id="ip-title">IP Info</h2>
            <!-- Mode -->
      <div class="fieldset" id="allowdhcp">
        <legend>Mode</legend>
        <label class="switch">
          <input type="checkbox" id="dhcp" disabled/>
          <span class="switch-label">Obtain an IP address automatically (DHCP)</span>
        </label>
      </div>
      <div class="fieldset">
        <legend>Static Settings</legend>

        <div class="row">
          <label class="field">
            <span class="label">IP Address</span>
            <div id="ip-addr" class="mono">—</div>
          </label>

          <label class="field">
            <span class="label">Subnet Mask</span>
            <div id="ip-mask" class="mono">—</div>
          </label>
        </div>

        <div class="row">
          <label class="field">
            <span class="label">Default Gateway</span>
            <div id="ip-gw" class="mono">—</div>
          </label>

          <label class="field">
            <span class="label">DNS Server</span>
            <div id="ip-dns" class="mono">—</div>
          </label>
        </div>
      </div>
      <!-- Device Info -->
      <div class="fieldset">
        <legend>Device Info</legend>

        <div class="row">
          <label class="field">
            <span class="label">MAC Address</span>
            <div id="ip-mac" class="mono">—</div>
          </label>

          <label class="field">
            <span class="label">Current IP</span>
            <div id="cur-ip-addr" class="mono">—</div>
          </label>
        </div>
      </div>
    </section>
  </main>


  <table class="center">
    <tr>
      <td>
        <a href="/ipconfig.html">Configure IP Addresses</a>
      </td>
    </tr>
    <tr>
      <td>
        <a href="/import">Import Switch Configuration</a>
      </td>
    </tr>
    <tr>
      <td>
        <a href="/export">Export Switch Configuration</a>
      </td>
    </tr>
    <tr>
      <td>
        <a href="/upgrade">Upgrade the Power Switch</a>
      </td>
    </tr>
    <tr>
      <td>
        <a href="/code">Source Code of the Pico Power Switch</a>
      </td>
    </tr>
    <tr>
      <td>
        <a href="/terminal.html">Console Terminal for the Pico Power Switch</a>
      </td>
    </tr>
  </table>
  <br> 
  <br>
  <script src="/js/rebootbutton.js"></script>
  <table class="center">
    <tr>
      <td>
        <a href="/"><button type="button" class="button2 button">Cancel</button></a>
      </td>
    </tr>
    <tr>
      <td>
        <button id="btn-reboot" type="button" class="button">REBOOT</button>
      </td>
    </tr>
  </table>
  <!-- Footer populated by footer.js -->
  <footer id="site-footer"></footer>

  <!-- Utilities: minimal HTML escaping -->
  <script>
    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/\"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }
    function tr(key, valueHtml) {
      return `<tr><td class="k">${escapeHtml(key)}</td><td class="v">${valueHtml}</td></tr>`;
    }
  </script>

  <!-- Your modules (as uploaded) -->
  <script src="/js/buildinfo.js"></script>
  <script src="/js/ipinfo.js"></script>

  <!-- Header/Footer scripts (they already call BuildInfo) -->
  <script src="/js/header.js"></script>
  <script src="/js/footer.js"></script>

  <!-- Page wiring: fetch data and render into tables -->
  <!-- Card population script -->
  <script>
    (async function populateCards() {
      try {
        // Build/Program Info
        const bi = await BuildInfo.getBuildInfo();
        setText("prog-product", safe(bi.product));
        setText("prog-version", safe(bi.version));
        setText("prog-date", safe(bi.build_date));
        setText("prog-time", safe(bi.build_time));
        setText("prog-author", safe(bi.author));
        setText("prog-device", safe(bi.device ?? "—"));

        // IP Info
        const ii = await IpInfo.getIpInfo();
        setText("ip-mac", safe(ii.macAddress));
        setText("ip-addr", safe(ii.ipAddress));
        setText("ip-mask", safe(ii.subnetMask));
        setText("ip-gw", safe(ii.gatewayAddress));
        setText("ip-dns", safe(ii.dnsAddress));
        setText("cur-ip-addr", safe(ii.ipAddress));
        // Form fields
        const dhcpMode = !!ii.isDHCP;
        setCheckbox("dhcp", dhcpMode);
      } catch (err) {
        console.error(err);
      }
    })();
    function setCheckbox(id, value) {
      const el = document.getElementById(id);
      if (el) el.checked = value;
    }
    function setText(id, text) {
      const el = document.getElementById(id);
      if (el) el.textContent = text ?? "—";
    }
    function safe(s) {
      // Minimal sanitization for defensive display (mirrors pattern in header/footer)
      return String(s ?? "—");
    }
  </script>
</body>
</html>