<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Import the JS modules -->
  <script type="module" src="/js/main.js"></script>
  <script type="module" src="/js/filebutton.js"></script>
  <link rel="stylesheet" href="/style/style.css">
</head>
<body>
  <!-- Use the custom elements -->
  <my-header></my-header>

  <main class="container">
    <!-- Your main page content goes here -->
    <config-card title="Server">
      <element-group legend="Program Information">
        <div class="row">
          <div class="field">
            <div class="label">Product</div>
            <div id="prog-product" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Version</div>
            <div id="prog-version" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Build Date</div>
            <div id="prog-date" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Build Time</div>
            <div id="prog-time" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Author</div>
            <div id="prog-author" class="mono">—</div>
          </div>
          <div class="field">
            <div class="label">Device</div>
            <div id="prog-device" class="mono">—</div>
          </div>
        </div>
      </element-group>
      <element-group legend="IP Information">
        <element-group legend="Mode" id="allowDHCP">
          <label class="switch">
            <input type="checkbox" id="dhcp" disabled/>
            <span class="switch-label">Obtain an IP address automatically (DHCP)</span>
          </label>
        </element-group>
        <element-group legend="Static Settings">
          <div class="row">
            <div class="field">
              <div class="label">IP Address</div>
              <div id="ip-addr" class="mono">—</div>
            </div>
            <div class="field">
              <div class="label">Subnet Mask</div>
              <div id="ip-mask" class="mono">—</div>
            </div>
            <div class="field">
              <div class="label">Default Gateway</div>
              <div id="ip-gw" class="mono">—</div>
            </div>
            <div class="field">
              <div class="label">DNS Server</div>
              <div id="ip-dns" class="mono">—</div>
            </div>
          </div>
        </element-group>
        <element-group legend="Device Info">
          <div class="row">
            <div class="field">
              <div class="label">MAC Address</div>
              <div id="ip-mac" class="mono">—</div>
            </div>
            <div class="field">
              <div class="label">Current IP</div>
              <div id="cur-ip-addr" class="mono">—</div>
            </div>
          </div>
        </element-group>
      </element-group>
    </config-card>
    <config-card title="Configuration and Control">
      <element-group legend="Configuration">
        <back-button link="/index.html" color="backward">Cancel</back-button>
        <nav-button link="/license.html" color="forward">Code</nav-button>
        <download-button color="forward" url="/api/export.json" filename="export.json">Export</download-button>
        <nav-button link="/ipconfig.html" color="forward">Configure</nav-button>
      </element-group>
      <element-group legend="Control">
        <nav-button link="/terminal.html" color="forward">Terminal</nav-button>
        <upload-button color="danger" endpoint="/api/export.json">Import</upload-button>
        <upgrade-button color="danger" upload-url="/var/pico.bin" upgrade-url="/api/upgrade.json">Upgrade</upgrade-button>
        <reboot-button color="danger">Reboot</reboot-button>
      </element-group>
    </config-card>
  </main>
  
  <my-footer></my-footer>

  <script type="module"> 
    import { BuildInfo } from '/js/buildinfo.js';
    import { IpInfo } from '/js/ipinfo.js';

    async function render() {
      try {
        BuildInfo.refreshBuildInfo();
        const bi = await BuildInfo.getBuildInfo();
        document.getElementById('prog-product').textContent=bi.product;
        document.getElementById('prog-version').textContent=bi.version;
        document.getElementById('prog-date').textContent=bi.build_date;
        document.getElementById('prog-time').textContent=bi.build_time;
        document.getElementById('prog-author').textContent=bi.author;
        document.getElementById('prog-device').textContent=bi.device;
        
        IpInfo.refreshIpInfo();
        const ii = await IpInfo.getIpInfo();
        document.getElementById('ip-addr').textContent=ii.ipAddress;
        document.getElementById('ip-mask').textContent=ii.subnetMask;
        document.getElementById('ip-gw').textContent=ii.gatewayAddress;
        document.getElementById('ip-dns').textContent=ii.dnsAddress;
        document.getElementById('ip-mac').textContent=ii.macAddress;
        document.getElementById('cur-ip-addr').textContent=ii.ipAddress;
        document.getElementById('allowDHCP').hidden=!ii.allowDHCP;
        document.getElementById('dhcp').disabled=!ii.allowDHCP;
        document.getElementById('dhcp').checked=ii.isDHCP;
      } catch (err) {
        console.error('[render error]', err);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', render, { once: true });
    } else {
      render();
    }
  </script>

</body>
</html>
